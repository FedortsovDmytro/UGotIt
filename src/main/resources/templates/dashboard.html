<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>UGotIt Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .navbar { margin-bottom: 20px; }
        .badge { font-size: 0.85rem; }
        .action-btns button, .action-btns a { margin-right: 5px; }
    </style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <span class="navbar-brand">UGotIt Dashboard</span>
    </div>
</nav>

<div class="container">

    <!-- Welcome -->
    <div class="mb-4">
        <h3>Welcome, <span th:text="${username}">User</span></h3>
        <p class="text-muted">Client portfolio overview</p>
    </div>

    <!-- Summary -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card p-3">
                <h6>Total Clients</h6>
                <h2 th:text="${totalItems}">0</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-3">
                <h6>Active Clients</h6>
                <h2 th:text="${activeItems}">0</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-3">
                <h6>Blocked Clients</h6>
                <h2 th:text="${blockedItems}">0</h2>
            </div>
        </div>
    </div>

    <!-- Risk explanation -->
    <div class="card p-4 mb-4">
        <h5>Risk Level Overview</h5>
        <ul class="list-unstyled mb-0">
            <li><span class="badge bg-success">LOW</span> – Stable client</li>
            <li><span class="badge bg-warning text-dark">MEDIUM</span> – Early warning signals</li>
            <li><span class="badge bg-danger">HIGH</span> – Serious risk</li>
            <li><span class="badge bg-dark">CRITICAL</span> – Immediate action required</li>
        </ul>
    </div>

    <!-- Clients table -->
    <div class="card p-3">
        <h5>Clients</h5>

        <table class="table table-striped align-middle mt-3">
            <thead>
            <tr>
                <th>
                    <a th:href="@{/dashboard(sort='id', dir=${sort == 'id' and dir == 'asc' ? 'desc' : 'asc'})}">
                        ID
                        <span th:if="${sort == 'id'}" th:text="${dir == 'asc' ? '▲' : '▼'}"></span>
                    </a>
                </th>
                <th>
                    <a th:href="@{/dashboard(sort='name', dir=${sort == 'name' and dir == 'asc' ? 'desc' : 'asc'})}">
                        Nazwa firmy
                        <span th:if="${sort == 'name'}" th:text="${dir == 'asc' ? '▲' : '▼'}"></span>
                    </a>
                </th>
                <th>
                    <a th:href="@{/dashboard(sort='risk', dir=${sort == 'risk' and dir == 'asc' ? 'desc' : 'asc'})}">
                        Risk
                        <span th:if="${sort == 'risk'}" th:text="${dir == 'asc' ? '▲' : '▼'}"></span>
                    </a>
                </th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="row : ${items}">
                <td th:text="${row.client.externalId}">201188</td>
                <td th:text="${row.client.name}">Company Name</td>
                <td>
                    <span class="badge bg-secondary" th:if="${row.riskLevel == null}">NOT CALCULATED</span>
                    <span class="badge bg-success" th:if="${row.riskLevel?.name() == 'LOW'}">LOW</span>
                    <span class="badge bg-warning text-dark" th:if="${row.riskLevel?.name() == 'MEDIUM'}">MEDIUM</span>
                    <span class="badge bg-danger" th:if="${row.riskLevel?.name() == 'HIGH'}">HIGH</span>
                    <span class="badge bg-dark" th:if="${row.riskLevel?.name() == 'CRITICAL'}">CRITICAL</span>
                </td>
                <td class="action-btns">
                    <!-- Recalculate -->
                    <form th:action="@{'/clients/' + ${row.client.externalId} + '/risk-assessments/recalculate'}"
                          method="post"
                          th:if="${row.riskLevel != null}"
                          style="display:inline-block;">
                        <button type="submit" class="btn btn-sm btn-outline-warning">Recalculate</button>
                    </form>

                    <!-- Describe -->
                    <a th:href="@{'/clients/' + ${row.client.externalId} + '/risk-assessments'}"
                       class="btn btn-sm btn-outline-primary"
                       th:if="${row.riskLevel != null}">
                        Describe
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
